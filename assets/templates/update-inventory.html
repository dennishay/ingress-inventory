{{template "Header" .}}
<div class="container">
{{$state := .Profile.Inventory.CurrentState}}
	<form method="post" action="/inventory/save" id="InventoryForm">
		<fieldset>
			<legend>Update Inventory</legend>
			<div class="row">
				<div class="control-group controls-row">
					<label class="control-label span2" for="Time">Entry Date</label>
					<div class="controls">
						<input class="span3" name="Time" type="datetime-local" value="{{$state.Time.Format "2006-01-02T15:04"}}">
					</div>
				</div>
				<div class="control-group controls-row">
					<label class="span2" for="AP">Action Points</label>
					<div class="controls">
						<input class="span3 L1" name="AP" type="number" min="0" value="{{$state.AP}}">
					</div>
				</div>
				<div class="control-group controls-row">
					<div class="span2">Resonators</div>
					<div class="controls">
{{range $i, $count := $state.Resonators}}
						<input class="span1 L{{add $i 1}}" name="Resonators" type="number" min="0" value="{{$i}}">
{{end}}
					</div>
					<div class="span2">0/0</div>
				</div>
				<div class="control-group controls-row">
					<div class="span2">XMPs</div>
					<div class="controls">
{{range $i, $count := $state.XMPs}}
						<input class="span1 L{{add $i 1}}" name="XMPs" type="number" min="0" value="{{$i}}">
{{end}}
					</div>
					<div class="span2">0/0</div>
				</div>
				<div class="control-group controls-row">
					<div class="span2">Power Cubes</div>
					<div class="controls">
{{range $i, $count := $state.PowerCubes}}
						<input class="span1 L{{add $i 1}}" name="PowerCubes" type="number" min="0" value="{{$i}}">
{{end}}
					</div>
					<div class="span2">0/0</div>
				</div>
				<div class="control-group controls-row">
					<div class="span2">Mods</div>
					<div class="controls">
{{range $i, $count := $state.Mods}}
						<input class="span1" name="Mods" type="number" min="0" value="{{$i}}">
{{end}}
					</div>
					<div class="span2 offset5">0/0</div>
				</div>
				<div class="control-group controls-row">
					<div class="span2">Portal Keys</div>
					<div class="controls">
						<input class="span8" type="text" value="0">
					</div>
					<div class="span2">0/0</div>
				</div>
				<div class="controls-row controls">
					<button type="submit" class="span2 offset4 btn btn-primary">Save changes</button>
					<button type="button" class="span2 btn">Cancel</button>
				</div>
			</div>
		</fieldset>
	</form>
	<script>
	$(function() {
		$("#InventoryForm").submit(function() {
			var self = $(this)
			if (validateTime(self.find("input[name=Time]")))
			return false
		})
	})
	var validateTime = function(e) {
		var fmt = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/
		var v = e.val()
		if (!fmt.test(v)) {
			setError(e, "Invalid format. Expect: yyyy-mm-ddThh:mm")
			return false
		}
		console.log(e.val())
	}
	var setError = function(e, err) {
		var sib
		var sibs = e.siblings('.err')
		if (sibs.length == 0) {
			sib = $('<span class="err inline-help"></span>')
			sib.insertAfter(e)
		} else {
			sib = $(sibs[0])
		}
		sib.text(err)
		e.parents(".control-group").addClass("error")
	}
	/* Some JavaScript for Portal Keys later
	var result = 5
	try {
		/[\d*+-/()]/
		resut = eval("1+2")
	} catch (e) {
		if (e instanceof SyntaxError) {

		} else {
			console.log(e.message)
		}
	}
	*/
	</script>
</div>
{{template "Footer" .}}
